
## 守护(Daemon)进程

我们可以认为守护进程就是后台服务进程，因为它会有一个很长的生命周期提供服务，关闭终端不会影响服务，也就是说可以忽略某些信号。

## 实现守护进程

首先要保证进程在后台运行，可以在启动程序后面加`&`，当然更原始的方法是进程自己`fork`然后结束父进程。

```c
if (pid=fork()) {
  exit(0); // Parent process
}
```

然后是与终端、进程组、会话(Session)分离。每个进程创建时都绑定一个终端，而且属于一个进程组(进程组也有GID不过等同进程组长的PID)，这些进程组在一个会话中，如果是子进程一般会从父进程继承这些信息，想要与环境分离可以使用以下的系统调用。

```c
setsid();
```

同样地我们会从父进程继承文件掩码(mask)，可以手动清理掩码。

```c
umask(0);
```

如果需要我们可以改变当前工作目录，避免运行时必须使用当前所在的文件系统。

## 使用Nohup

前面提到过`nohup`命令，是让程序以守护进程运行的方式之一，程序运行后忽略SIGHUP信号，也就说关闭终端不会影响进程的运行。

类似的命令还有`disown`，这里不再详述。
